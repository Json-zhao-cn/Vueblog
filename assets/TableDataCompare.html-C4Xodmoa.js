import{_ as s,c as a,a as p,o as t}from"./app-DZFgIm2e.js";const e={};function o(c,n){return t(),a("div",null,[...n[0]||(n[0]=[p(`<h2 id="compare-different-database-same-table-data-count" tabindex="-1"><a class="header-anchor" href="#compare-different-database-same-table-data-count"><span><strong>Compare different database same table data count</strong></span></a></h2><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">import</span> pyodbc</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Connection strings (adjust your server, user, password, db)</span></span>
<span class="line">src_conn_str <span class="token operator">=</span> <span class="token punctuation">(</span></span>
<span class="line">    <span class="token string">&quot;DRIVER={ODBC Driver 17 for SQL Server};&quot;</span></span>
<span class="line">    <span class="token string">&quot;SERVER=ip;DATABASE=db;UID=user;PWD=ps&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line">tgt_conn_str <span class="token operator">=</span> <span class="token punctuation">(</span></span>
<span class="line">    <span class="token string">&quot;DRIVER={ODBC Driver 17 for SQL Server};&quot;</span></span>
<span class="line">    <span class="token string">&quot;SERVER=ip;DATABASE=db;UID=user;PWD=ps&quot;</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">get_table_count</span><span class="token punctuation">(</span>cursor<span class="token punctuation">,</span> table_name<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token triple-quoted-string string">&quot;&quot;&quot;Get Table row count.&quot;&quot;&quot;</span></span>
<span class="line">    cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;SELECT count(1) FROM </span><span class="token interpolation"><span class="token punctuation">{</span>table_name<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">return</span> cursor<span class="token punctuation">.</span>fetchone<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">compare_tables</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token comment"># Connect</span></span>
<span class="line">    src_conn <span class="token operator">=</span> pyodbc<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>src_conn_str<span class="token punctuation">)</span></span>
<span class="line">    tgt_conn <span class="token operator">=</span> pyodbc<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>tgt_conn_str<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># Cursor</span></span>
<span class="line">    src_cursor <span class="token operator">=</span> src_conn<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    tgt_cursor <span class="token operator">=</span> tgt_conn<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># List of tables to compare</span></span>
<span class="line">    tables <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;TableA&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;TableB&quot;</span><span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;üìä Table data compare report&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;=&quot;</span> <span class="token operator">*</span> <span class="token number">70</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    results <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span>
<span class="line">    total_differences <span class="token operator">=</span> <span class="token number">0</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">for</span> table <span class="token keyword">in</span> tables<span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">try</span><span class="token punctuation">:</span></span>
<span class="line">            src_count <span class="token operator">=</span> get_table_count<span class="token punctuation">(</span>src_cursor<span class="token punctuation">,</span> table<span class="token punctuation">)</span></span>
<span class="line">            tgt_count <span class="token operator">=</span> get_table_count<span class="token punctuation">(</span>tgt_cursor<span class="token punctuation">,</span> table<span class="token punctuation">)</span></span>
<span class="line">            </span>
<span class="line">            difference <span class="token operator">=</span> src_count <span class="token operator">-</span> tgt_count</span>
<span class="line">            difference_percent <span class="token operator">=</span> <span class="token punctuation">(</span>difference <span class="token operator">/</span> src_count <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token keyword">if</span> src_count <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token number">0</span></span>
<span class="line">            is_match <span class="token operator">=</span> difference <span class="token operator">==</span> <span class="token number">0</span></span>
<span class="line">            </span>
<span class="line">            results<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">                <span class="token string">&#39;table&#39;</span><span class="token punctuation">:</span> table<span class="token punctuation">,</span></span>
<span class="line">                <span class="token string">&#39;src_count&#39;</span><span class="token punctuation">:</span> src_count<span class="token punctuation">,</span></span>
<span class="line">                <span class="token string">&#39;tgt_count&#39;</span><span class="token punctuation">:</span> tgt_count<span class="token punctuation">,</span></span>
<span class="line">                <span class="token string">&#39;difference&#39;</span><span class="token punctuation">:</span> difference<span class="token punctuation">,</span></span>
<span class="line">                <span class="token string">&#39;difference_percent&#39;</span><span class="token punctuation">:</span> difference_percent<span class="token punctuation">,</span></span>
<span class="line">                <span class="token string">&#39;is_match&#39;</span><span class="token punctuation">:</span> is_match</span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">            </span>
<span class="line">            <span class="token keyword">if</span> <span class="token keyword">not</span> is_match<span class="token punctuation">:</span></span>
<span class="line">                total_differences <span class="token operator">+=</span> <span class="token number">1</span></span>
<span class="line">                </span>
<span class="line">        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span></span>
<span class="line">            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;‚ùå query table:=&gt; </span><span class="token interpolation"><span class="token punctuation">{</span>table<span class="token punctuation">}</span></span><span class="token string"> error: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">            results<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">                <span class="token string">&#39;table&#39;</span><span class="token punctuation">:</span> table<span class="token punctuation">,</span></span>
<span class="line">                <span class="token string">&#39;error&#39;</span><span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># print results</span></span>
<span class="line">    <span class="token keyword">for</span> result <span class="token keyword">in</span> results<span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token string">&#39;error&#39;</span> <span class="token keyword">in</span> result<span class="token punctuation">:</span></span>
<span class="line">            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Table: </span><span class="token interpolation"><span class="token punctuation">{</span>result<span class="token punctuation">[</span><span class="token string">&#39;table&#39;</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string"> - ‚ùå error: </span><span class="token interpolation"><span class="token punctuation">{</span>result<span class="token punctuation">[</span><span class="token string">&#39;error&#39;</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">else</span><span class="token punctuation">:</span></span>
<span class="line">            status_icon <span class="token operator">=</span> <span class="token string">&quot;‚úÖ&quot;</span> <span class="token keyword">if</span> result<span class="token punctuation">[</span><span class="token string">&#39;is_match&#39;</span><span class="token punctuation">]</span> <span class="token keyword">else</span> <span class="token string">&quot;‚ùå&quot;</span></span>
<span class="line">            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>status_icon<span class="token punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token punctuation">{</span>result<span class="token punctuation">[</span><span class="token string">&#39;table&#39;</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;    Source DB: </span><span class="token interpolation"><span class="token punctuation">{</span>result<span class="token punctuation">[</span><span class="token string">&#39;src_count&#39;</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token format-spec">,</span><span class="token punctuation">}</span></span><span class="token string"> count&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;    Target DB: </span><span class="token interpolation"><span class="token punctuation">{</span>result<span class="token punctuation">[</span><span class="token string">&#39;tgt_count&#39;</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token format-spec">,</span><span class="token punctuation">}</span></span><span class="token string"> count&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token keyword">if</span> <span class="token keyword">not</span> result<span class="token punctuation">[</span><span class="token string">&#39;is_match&#39;</span><span class="token punctuation">]</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;    üî∏ difference: </span><span class="token interpolation"><span class="token punctuation">{</span>result<span class="token punctuation">[</span><span class="token string">&#39;difference&#39;</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token format-spec">+,</span><span class="token punctuation">}</span></span><span class="token string"> count (</span><span class="token interpolation"><span class="token punctuation">{</span>result<span class="token punctuation">[</span><span class="token string">&#39;difference_percent&#39;</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token format-spec">+.2f</span><span class="token punctuation">}</span></span><span class="token string">%)&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;    &quot;</span> <span class="token operator">+</span> <span class="token string">&quot;-&quot;</span> <span class="token operator">*</span> <span class="token number">30</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;=&quot;</span> <span class="token operator">*</span> <span class="token number">70</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;üìà summarizing:&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   Total Table: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>tables<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   Same Tabe Count: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>tables<span class="token punctuation">)</span> <span class="token operator">-</span> total_differences<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   Difference Table Count: </span><span class="token interpolation"><span class="token punctuation">{</span>total_differences<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment"># disconnect</span></span>
<span class="line">    src_cursor<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    tgt_cursor<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    src_conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    tgt_conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">return</span> results</span>
<span class="line"></span>
<span class="line"><span class="token comment"># execute</span></span>
<span class="line"><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span></span>
<span class="line">    compare_tables<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,2)])])}const i=s(e,[["render",o]]),u=JSON.parse('{"path":"/blogs/Skills/Python/TableDataCompare.html","title":"Compare different database same table data count","lang":"en-US","frontmatter":{"title":"Compare different database same table data count","date":"2025/10/05","tags":["Python"],"categories":["Skills"]},"headers":[{"level":2,"title":"Compare different database same table data count","slug":"compare-different-database-same-table-data-count","link":"#compare-different-database-same-table-data-count","children":[]}],"git":{"createdTime":1763109587000,"updatedTime":1763109587000,"contributors":[{"name":"jsonzhao","email":"json.zhao.cn@outlook.com","commits":1}]},"filePathRelative":"blogs/Skills/Python/TableDataCompare.md"}');export{i as comp,u as data};
