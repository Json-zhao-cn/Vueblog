import{_ as s,c as a,b as p,o as e}from"./app-Z9C42F7L.js";const t={};function l(o,n){return e(),a("div",null,[...n[0]||(n[0]=[p(`<h4 id="user-sqlfuncation-to-convert-xml-to-json-in-the-sql-server" tabindex="-1"><a class="header-anchor" href="#user-sqlfuncation-to-convert-xml-to-json-in-the-sql-server"><span>User SQLFuncation to convert XML to Json in the SQL Server</span></a></h4><ol><li>UserFuncation</li></ol><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">USE</span> <span class="token punctuation">[</span>YourDB<span class="token punctuation">]</span></span>
<span class="line">GO</span>
<span class="line"><span class="token comment">/****** </span>
<span class="line">	Object:  UserDefinedFunction [dbo].[AF_XmlToJson]    </span>
<span class="line">	Author: json zhao</span>
<span class="line">	Script Date: 5/10/2024 5:13:42 PM </span>
<span class="line">******/</span></span>
<span class="line"><span class="token keyword">SET</span> ANSI_NULLS <span class="token keyword">ON</span></span>
<span class="line">GO</span>
<span class="line"><span class="token keyword">SET</span> QUOTED_IDENTIFIER <span class="token keyword">ON</span></span>
<span class="line">GO</span>
<span class="line"><span class="token keyword">ALTER</span> <span class="token keyword">FUNCTION</span> <span class="token punctuation">[</span>dbo<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>AF_XmlToJson<span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">(</span></span>
<span class="line">	<span class="token variable">@XML</span> XML</span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">RETURNS</span> NVARCHAR<span class="token punctuation">(</span>MAX<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">AS</span></span>
<span class="line"><span class="token keyword">BEGIN</span></span>
<span class="line"><span class="token keyword">DECLARE</span> <span class="token variable">@Input</span> XML <span class="token operator">=</span> <span class="token variable">@XML</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">-----------Temp Table 1-------------------</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">DECLARE</span> <span class="token variable">@TempTable1</span> <span class="token keyword">TABLE</span> <span class="token punctuation">(</span></span>
<span class="line">	ID <span class="token keyword">INT</span> <span class="token keyword">IDENTITY</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span></span>
<span class="line">	<span class="token punctuation">,</span>ColumnName NVARCHAR<span class="token punctuation">(</span>MAX<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">,</span>ColumnValue NVARCHAR<span class="token punctuation">(</span>MAX<span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token variable">@TempTable1</span></span>
<span class="line"><span class="token keyword">SELECT</span> N<span class="token punctuation">.</span>x<span class="token punctuation">.</span><span class="token keyword">value</span><span class="token punctuation">(</span><span class="token string">&#39;../@Key&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;NVARCHAR(MAX)&#39;</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">,</span><span class="token string">&#39;&quot;&#39;</span> <span class="token operator">+</span> N<span class="token punctuation">.</span>x<span class="token punctuation">.</span><span class="token keyword">value</span><span class="token punctuation">(</span><span class="token string">&#39;(text())[1]&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;NVARCHAR(MAX)&#39;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&#39;&quot;&#39;</span></span>
<span class="line"><span class="token keyword">FROM</span> <span class="token variable">@Input.nodes</span><span class="token punctuation">(</span><span class="token string">&#39;//Inputs/PropertyBagItem/Value&#39;</span><span class="token punctuation">)</span> N<span class="token punctuation">(</span>x<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment">-----------Temp Table 2-------------------</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">DECLARE</span> <span class="token variable">@TempTable2</span> <span class="token keyword">TABLE</span> <span class="token punctuation">(</span></span>
<span class="line">	ID <span class="token keyword">INT</span> <span class="token keyword">IDENTITY</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span></span>
<span class="line">	<span class="token punctuation">,</span>ColumnName NVARCHAR<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">,</span>ColumnValue NVARCHAR<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token variable">@TempTable2</span></span>
<span class="line"><span class="token keyword">SELECT</span> N<span class="token punctuation">.</span>x<span class="token punctuation">.</span><span class="token keyword">value</span><span class="token punctuation">(</span><span class="token string">&#39;../../@Key&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;NVARCHAR(MAX)&#39;</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token punctuation">,</span>N<span class="token punctuation">.</span>x<span class="token punctuation">.</span><span class="token keyword">value</span><span class="token punctuation">(</span><span class="token string">&#39;(text())[1]&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;NVARCHAR(MAX)&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">FROM</span> <span class="token variable">@Input.nodes</span><span class="token punctuation">(</span><span class="token string">&#39;//Inputs/PropertyBagItem/Value/*&#39;</span><span class="token punctuation">)</span> N<span class="token punctuation">(</span>x<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment">---Build JSON-----</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token variable">@TempTable1</span></span>
<span class="line"><span class="token keyword">SELECT</span> A<span class="token punctuation">.</span>Columnname</span>
<span class="line">	<span class="token punctuation">,</span>A<span class="token punctuation">.</span>List</span>
<span class="line"><span class="token keyword">FROM</span> <span class="token punctuation">(</span></span>
<span class="line">	<span class="token keyword">SELECT</span> ColumnName</span>
<span class="line">		<span class="token punctuation">,</span><span class="token string">&#39;[&#39;</span> <span class="token operator">+</span> STUFF<span class="token punctuation">(</span><span class="token punctuation">(</span></span>
<span class="line">				<span class="token keyword">SELECT</span> <span class="token string">&#39;, &#39;</span> <span class="token operator">+</span> <span class="token string">&#39;&quot;&#39;</span> <span class="token operator">+</span> <span class="token keyword">case</span> <span class="token keyword">when</span> ColumnValue <span class="token operator">is</span> <span class="token boolean">null</span> <span class="token keyword">then</span> <span class="token string">&#39;&#39;</span> <span class="token keyword">else</span> ColumnValue <span class="token keyword">end</span> <span class="token operator">+</span> <span class="token string">&#39;&quot;&#39;</span></span>
<span class="line">				<span class="token keyword">FROM</span> <span class="token variable">@TempTable2</span></span>
<span class="line">				<span class="token keyword">WHERE</span> ColumnName <span class="token operator">=</span> t<span class="token punctuation">.</span>ColumnName</span>
<span class="line">				<span class="token keyword">FOR</span> XML PATH<span class="token punctuation">(</span><span class="token string">&#39;&#39;</span><span class="token punctuation">)</span></span>
<span class="line">					<span class="token punctuation">,</span><span class="token keyword">TYPE</span></span>
<span class="line">				<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">value</span><span class="token punctuation">(</span><span class="token string">&#39;.&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;NVARCHAR(MAX)&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&#39;]&#39;</span> List</span>
<span class="line">	<span class="token keyword">FROM</span> <span class="token variable">@TempTable2</span> t</span>
<span class="line">	<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> ColumnName</span>
<span class="line">	<span class="token punctuation">)</span> A</span>
<span class="line"></span>
<span class="line"><span class="token keyword">DECLARE</span> <span class="token variable">@Result</span> NVARCHAR<span class="token punctuation">(</span>MAX<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span></span>
<span class="line">		<span class="token keyword">SELECT</span> <span class="token string">&#39;{&quot;&#39;</span> <span class="token operator">+</span> STUFF<span class="token punctuation">(</span><span class="token punctuation">(</span></span>
<span class="line">					<span class="token keyword">SELECT</span> <span class="token keyword">COALESCE</span><span class="token punctuation">(</span><span class="token string">&#39;&quot;&#39;</span> <span class="token operator">+</span> ColumnName <span class="token operator">+</span> <span class="token string">&#39;&quot;:&#39;</span> <span class="token operator">+</span> ColumnValue <span class="token operator">+</span> <span class="token string">&#39;,&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span></span>
<span class="line">					<span class="token keyword">FROM</span> <span class="token variable">@TempTable1</span></span>
<span class="line">					<span class="token keyword">FOR</span> XML PATH<span class="token punctuation">(</span><span class="token string">&#39;&#39;</span><span class="token punctuation">)</span></span>
<span class="line">						<span class="token punctuation">,</span><span class="token keyword">TYPE</span></span>
<span class="line">					<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">value</span><span class="token punctuation">(</span><span class="token string">&#39;.&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;NVARCHAR(MAX)&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span></span>
<span class="line">		<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">DECLARE</span> <span class="token variable">@JSON_Out</span> NVARCHAR<span class="token punctuation">(</span>MAX<span class="token punctuation">)</span> <span class="token operator">=</span> SUBSTRING<span class="token punctuation">(</span><span class="token variable">@Result</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token function">LEN</span><span class="token punctuation">(</span><span class="token variable">@Result</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&#39;}&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">RETURN</span> <span class="token variable">@JSON_Out</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">END</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,3)])])}const i=s(t,[["render",l]]),u=JSON.parse('{"path":"/blogs/Skills/SQLServer/Funcation/AF_XmlToJson.html","title":"Convert XML to Json in the SQL Server","lang":"en-US","frontmatter":{"title":"Convert XML to Json in the SQL Server","date":"2024/10/5","tags":["SQLServer"],"categories":["Skills"]},"headers":[],"git":{"createdTime":1763103282000,"updatedTime":1763103282000,"contributors":[{"name":"jsonzhao","email":"json.zhao.cn@outlook.com","commits":1}]},"filePathRelative":"blogs/Skills/SQLServer/Funcation/AF_XmlToJson.md"}');export{i as comp,u as data};
