import{_ as a,c as n,a as e,o as l}from"./app-BWHYZH_D.js";const t={};function p(i,s){return l(),n("div",null,[...s[0]||(s[0]=[e(`<h2 id="enable-sql-server-change-data-capture-cdc" tabindex="-1"><a class="header-anchor" href="#enable-sql-server-change-data-capture-cdc"><span><strong>enable SQL Server Change Data Capture (CDC)</strong></span></a></h2><h3 id="_1-enable-cdc-at-the-database-level" tabindex="-1"><a class="header-anchor" href="#_1-enable-cdc-at-the-database-level"><span>1. Enable CDC at the database level</span></a></h3><p>Run this once for the database:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">USE</span> YourDatabase<span class="token punctuation">;</span></span>
<span class="line">GO</span>
<span class="line"><span class="token keyword">EXEC</span> sys<span class="token punctuation">.</span>sp_cdc_enable_db<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="_2-enable-cdc-on-each-table" tabindex="-1"><a class="header-anchor" href="#_2-enable-cdc-on-each-table"><span>2. Enable CDC on each table</span></a></h3><p>For each table (A, B, C…), run:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">EXEC</span> sys<span class="token punctuation">.</span>sp_cdc_enable_table  </span>
<span class="line">    <span class="token variable">@source_schema</span> <span class="token operator">=</span> N<span class="token string">&#39;dbo&#39;</span><span class="token punctuation">,</span>  </span>
<span class="line">    <span class="token variable">@source_name</span>   <span class="token operator">=</span> N<span class="token string">&#39;TableA&#39;</span><span class="token punctuation">,</span>  </span>
<span class="line">    <span class="token variable">@role_name</span>     <span class="token operator">=</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span>  <span class="token comment">-- or a role like &#39;cdc_reader&#39;</span></span>
<span class="line">GO</span>
<span class="line"></span>
<span class="line"><span class="token keyword">EXEC</span> sys<span class="token punctuation">.</span>sp_cdc_enable_table  </span>
<span class="line">    <span class="token variable">@source_schema</span> <span class="token operator">=</span> N<span class="token string">&#39;dbo&#39;</span><span class="token punctuation">,</span>  </span>
<span class="line">    <span class="token variable">@source_name</span>   <span class="token operator">=</span> N<span class="token string">&#39;TableB&#39;</span><span class="token punctuation">,</span>  </span>
<span class="line">    <span class="token variable">@role_name</span>     <span class="token operator">=</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span></span>
<span class="line">GO</span>
<span class="line"></span>
<span class="line"><span class="token keyword">EXEC</span> sys<span class="token punctuation">.</span>sp_cdc_enable_table  </span>
<span class="line">    <span class="token variable">@source_schema</span> <span class="token operator">=</span> N<span class="token string">&#39;dbo&#39;</span><span class="token punctuation">,</span>  </span>
<span class="line">    <span class="token variable">@source_name</span>   <span class="token operator">=</span> N<span class="token string">&#39;TableC&#39;</span><span class="token punctuation">,</span>  </span>
<span class="line">    <span class="token variable">@role_name</span>     <span class="token operator">=</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span></span>
<span class="line">GO</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="_3-configure-retention-period-3-days" tabindex="-1"><a class="header-anchor" href="#_3-configure-retention-period-3-days"><span>3. Configure retention period (3 days)</span></a></h3><p>By default, CDC keeps change data for <strong>3 days (72 hours)</strong>, but you can explicitly set it:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token comment">-- Modify the retention period for the CDC cleaning job to 3 days (4,320 minutes)</span></span>
<span class="line"><span class="token keyword">USE</span> ReportCenter</span>
<span class="line">GO</span>
<span class="line"><span class="token keyword">EXEC</span> sys<span class="token punctuation">.</span>sp_cdc_change_job </span>
<span class="line">    <span class="token variable">@job_type</span> <span class="token operator">=</span> <span class="token string">&#39;cleanup&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token variable">@retention</span> <span class="token operator">=</span> <span class="token number">4320</span>  <span class="token comment">-- 3 days × 24 hours × 60 minutes = 4320 minutes</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>✅ This ensures the CDC cleanup job removes changes older than 3 days.</p><hr><h3 id="_4-verify-settings" tabindex="-1"><a class="header-anchor" href="#_4-verify-settings"><span>4. Verify settings</span></a></h3><p>Check retention and job info:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">EXEC</span> sys<span class="token punctuation">.</span>sp_cdc_help_jobs<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Check enabled tables:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> sys<span class="token punctuation">.</span><span class="token keyword">tables</span> <span class="token keyword">WHERE</span> is_tracked_by_cdc <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><hr><h3 id="_5-optional-disable-cdc-on-a-table-or-db" tabindex="-1"><a class="header-anchor" href="#_5-optional-disable-cdc-on-a-table-or-db"><span>5. (Optional) Disable CDC on a table or DB</span></a></h3><p>If later you want to remove CDC:</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token comment">-- Disable table-level CDC</span></span>
<span class="line"><span class="token keyword">EXEC</span> sys<span class="token punctuation">.</span>sp_cdc_disable_table  </span>
<span class="line">    <span class="token variable">@source_schema</span> <span class="token operator">=</span> N<span class="token string">&#39;dbo&#39;</span><span class="token punctuation">,</span>  </span>
<span class="line">    <span class="token variable">@source_name</span>   <span class="token operator">=</span> N<span class="token string">&#39;TableA&#39;</span><span class="token punctuation">,</span>  </span>
<span class="line">    <span class="token variable">@capture_instance</span> <span class="token operator">=</span> <span class="token string">&#39;all&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">-- Disable database-level CDC</span></span>
<span class="line"><span class="token keyword">USE</span> YourDatabase<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">EXEC</span> sys<span class="token punctuation">.</span>sp_cdc_disable_db<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><p>⚡ Summary:</p><ul><li>Enable CDC at <strong>DB level</strong> (<code>sp_cdc_enable_db</code>)</li><li>Enable CDC for each table (<code>sp_cdc_enable_table</code>)</li><li>Set <strong>3-day cleanup</strong> with <code>sp_cdc_change_job @retention = 259200</code></li></ul><hr>`,27)])])}const o=a(t,[["render",p]]),r=JSON.parse('{"path":"/blogs/Skills/SQLServer/CDC/cdcImplement.html","title":"How to implement cdc in the SQL Server","lang":"en-US","frontmatter":{"title":"How to implement cdc in the SQL Server","date":"2025/10/05","tags":["SQLServerCDC"],"categories":["Skills"]},"headers":[{"level":2,"title":"enable SQL Server Change Data Capture (CDC)","slug":"enable-sql-server-change-data-capture-cdc","link":"#enable-sql-server-change-data-capture-cdc","children":[{"level":3,"title":"1. Enable CDC at the database level","slug":"_1-enable-cdc-at-the-database-level","link":"#_1-enable-cdc-at-the-database-level","children":[]},{"level":3,"title":"2. Enable CDC on each table","slug":"_2-enable-cdc-on-each-table","link":"#_2-enable-cdc-on-each-table","children":[]},{"level":3,"title":"3. Configure retention period (3 days)","slug":"_3-configure-retention-period-3-days","link":"#_3-configure-retention-period-3-days","children":[]},{"level":3,"title":"4. Verify settings","slug":"_4-verify-settings","link":"#_4-verify-settings","children":[]},{"level":3,"title":"5. (Optional) Disable CDC on a table or DB","slug":"_5-optional-disable-cdc-on-a-table-or-db","link":"#_5-optional-disable-cdc-on-a-table-or-db","children":[]}]}],"git":{"createdTime":1762950152000,"updatedTime":1762950152000,"contributors":[{"name":"Zhao Json","email":"json.zhao@scania.com.cn","commits":1}]},"filePathRelative":"blogs/Skills/SQLServer/CDC/cdcImplement.md"}');export{o as comp,r as data};
